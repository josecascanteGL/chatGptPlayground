77u/PCNAIHRlbXBsYXRlIGxhbmd1YWdlPSJDIyIgZGVidWc9ImZhbHNlIiBo
b3N0c3BlY2lmaWM9InRydWUiIz4KPCNAIGluY2x1ZGUgZmlsZT0iRUY2LlV0
aWxpdHkuQ1MudHRpbmNsdWRlIiM+PCNACiBvdXRwdXQgZXh0ZW5zaW9uPSIu
Y3MiIz48IwoKY29uc3Qgc3RyaW5nIGlucHV0RmlsZSA9IEAiVW5pY29yblNo
b3AuZWRteCI7CnZhciB0ZXh0VHJhbnNmb3JtID0gRHluYW1pY1RleHRUcmFu
c2Zvcm1hdGlvbi5DcmVhdGUodGhpcyk7CnZhciBjb2RlID0gbmV3IENvZGVH
ZW5lcmF0aW9uVG9vbHModGhpcyk7CnZhciBlZiA9IG5ldyBNZXRhZGF0YVRv
b2xzKHRoaXMpOwp2YXIgdHlwZU1hcHBlciA9IG5ldyBUeXBlTWFwcGVyKGNv
ZGUsIGVmLCB0ZXh0VHJhbnNmb3JtLkVycm9ycyk7CnZhciBsb2FkZXIgPSBu
ZXcgRWRtTWV0YWRhdGFMb2FkZXIodGV4dFRyYW5zZm9ybS5Ib3N0LCB0ZXh0
VHJhbnNmb3JtLkVycm9ycyk7CnZhciBpdGVtQ29sbGVjdGlvbiA9IGxvYWRl
ci5DcmVhdGVFZG1JdGVtQ29sbGVjdGlvbihpbnB1dEZpbGUpOwp2YXIgbW9k
ZWxOYW1lc3BhY2UgPSBsb2FkZXIuR2V0TW9kZWxOYW1lc3BhY2UoaW5wdXRG
aWxlKTsKdmFyIGNvZGVTdHJpbmdHZW5lcmF0b3IgPSBuZXcgQ29kZVN0cmlu
Z0dlbmVyYXRvcihjb2RlLCB0eXBlTWFwcGVyLCBlZik7Cgp2YXIgY29udGFp
bmVyID0gaXRlbUNvbGxlY3Rpb24uT2ZUeXBlPEVudGl0eUNvbnRhaW5lcj4o
KS5GaXJzdE9yRGVmYXVsdCgpOwppZiAoY29udGFpbmVyID09IG51bGwpCnsK
ICAgIHJldHVybiBzdHJpbmcuRW1wdHk7Cn0KIz4KLy8tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gPGF1dG8tZ2VuZXJhdGVkPgovLyA8
Iz1Db2RlR2VuZXJhdGlvblRvb2xzLkdldFJlc291cmNlU3RyaW5nKCJUZW1w
bGF0ZV9HZW5lcmF0ZWRDb2RlQ29tbWVudExpbmUxIikjPgovLwovLyA8Iz1D
b2RlR2VuZXJhdGlvblRvb2xzLkdldFJlc291cmNlU3RyaW5nKCJUZW1wbGF0
ZV9HZW5lcmF0ZWRDb2RlQ29tbWVudExpbmUyIikjPgovLyA8Iz1Db2RlR2Vu
ZXJhdGlvblRvb2xzLkdldFJlc291cmNlU3RyaW5nKCJUZW1wbGF0ZV9HZW5l
cmF0ZWRDb2RlQ29tbWVudExpbmUzIikjPgovLyA8L2F1dG8tZ2VuZXJhdGVk
PgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKPCMKCnZh
ciBjb2RlTmFtZXNwYWNlID0gY29kZS5Wc05hbWVzcGFjZVN1Z2dlc3Rpb24o
KTsKaWYgKCFTdHJpbmcuSXNOdWxsT3JFbXB0eShjb2RlTmFtZXNwYWNlKSkK
ewojPgpuYW1lc3BhY2UgPCM9Y29kZS5Fc2NhcGVOYW1lc3BhY2UoY29kZU5h
bWVzcGFjZSkjPgp7CjwjCiAgICBQdXNoSW5kZW50KCIgICAgIik7Cn0KCiM+
CnVzaW5nIFN5c3RlbTsKdXNpbmcgU3lzdGVtLkRhdGEuRW50aXR5Owp1c2lu
ZyBTeXN0ZW0uRGF0YS5FbnRpdHkuSW5mcmFzdHJ1Y3R1cmU7CjwjCmlmIChj
b250YWluZXIuRnVuY3Rpb25JbXBvcnRzLkFueSgpKQp7CiM+CnVzaW5nIFN5
c3RlbS5EYXRhLkVudGl0eS5Db3JlLk9iamVjdHM7CnVzaW5nIFN5c3RlbS5M
aW5xOwo8Iwp9CiM+Cgo8Iz1BY2Nlc3NpYmlsaXR5LkZvclR5cGUoY29udGFp
bmVyKSM+IHBhcnRpYWwgY2xhc3MgPCM9Y29kZS5Fc2NhcGUoY29udGFpbmVy
KSM+IDogRGJDb250ZXh0CnsKICAgIHB1YmxpYyA8Iz1jb2RlLkVzY2FwZShj
b250YWluZXIpIz4oKQogICAgICAgIDogYmFzZSgibmFtZT08Iz1jb250YWlu
ZXIuTmFtZSM+IikKICAgIHsKPCMKaWYgKCFsb2FkZXIuSXNMYXp5TG9hZGlu
Z0VuYWJsZWQoY29udGFpbmVyKSkKewojPgogICAgICAgIHRoaXMuQ29uZmln
dXJhdGlvbi5MYXp5TG9hZGluZ0VuYWJsZWQgPSBmYWxzZTsKPCMKfQoKZm9y
ZWFjaCAodmFyIGVudGl0eVNldCBpbiBjb250YWluZXIuQmFzZUVudGl0eVNl
dHMuT2ZUeXBlPEVudGl0eVNldD4oKSkKewogICAgLy8gTm90ZTogdGhlIERi
U2V0IG1lbWJlcnMgYXJlIGRlZmluZWQgYmVsb3cgc3VjaCB0aGF0IHRoZSBn
ZXR0ZXIgYW5kCiAgICAvLyBzZXR0ZXIgYWx3YXlzIGhhdmUgdGhlIHNhbWUg
YWNjZXNzaWJpbGl0eSBhcyB0aGUgRGJTZXQgZGVmaW5pdGlvbgogICAgaWYg
KEFjY2Vzc2liaWxpdHkuRm9yUmVhZE9ubHlQcm9wZXJ0eShlbnRpdHlTZXQp
ICE9ICJwdWJsaWMiKQogICAgewojPgogICAgICAgIDwjPWNvZGVTdHJpbmdH
ZW5lcmF0b3IuRGJTZXRJbml0aWFsaXplcihlbnRpdHlTZXQpIz4KPCMKICAg
IH0KfQojPgogICAgfQoKICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIE9u
TW9kZWxDcmVhdGluZyhEYk1vZGVsQnVpbGRlciBtb2RlbEJ1aWxkZXIpCiAg
ICB7CiAgICAgICAgdGhyb3cgbmV3IFVuaW50ZW50aW9uYWxDb2RlRmlyc3RF
eGNlcHRpb24oKTsKICAgIH0KCjwjCiAgICBmb3JlYWNoICh2YXIgZW50aXR5
U2V0IGluIGNvbnRhaW5lci5CYXNlRW50aXR5U2V0cy5PZlR5cGU8RW50aXR5
U2V0PigpKQogICAgewojPgogICAgPCM9Y29kZVN0cmluZ0dlbmVyYXRvci5E
YlNldChlbnRpdHlTZXQpIz4KPCMKICAgIH0KCiAgICBmb3JlYWNoICh2YXIg
ZWRtRnVuY3Rpb24gaW4gY29udGFpbmVyLkZ1bmN0aW9uSW1wb3J0cykKICAg
IHsKICAgICAgICBXcml0ZUZ1bmN0aW9uSW1wb3J0KHR5cGVNYXBwZXIsIGNv
ZGVTdHJpbmdHZW5lcmF0b3IsIGVkbUZ1bmN0aW9uLCBtb2RlbE5hbWVzcGFj
ZSwgaW5jbHVkZU1lcmdlT3B0aW9uOiBmYWxzZSk7CiAgICB9CiM+Cn0KPCMK
CmlmICghU3RyaW5nLklzTnVsbE9yRW1wdHkoY29kZU5hbWVzcGFjZSkpCnsK
ICAgIFBvcEluZGVudCgpOwojPgp9CjwjCn0KIz4KPCMrCgpwcml2YXRlIHZv
aWQgV3JpdGVGdW5jdGlvbkltcG9ydChUeXBlTWFwcGVyIHR5cGVNYXBwZXIs
IENvZGVTdHJpbmdHZW5lcmF0b3IgY29kZVN0cmluZ0dlbmVyYXRvciwgRWRt
RnVuY3Rpb24gZWRtRnVuY3Rpb24sIHN0cmluZyBtb2RlbE5hbWVzcGFjZSwg
Ym9vbCBpbmNsdWRlTWVyZ2VPcHRpb24pCnsKICAgIGlmICh0eXBlTWFwcGVy
LklzQ29tcG9zYWJsZShlZG1GdW5jdGlvbikpCiAgICB7CiM+CgogICAgW0Ri
RnVuY3Rpb24oIjwjPWVkbUZ1bmN0aW9uLk5hbWVzcGFjZU5hbWUjPiIsICI8
Iz1lZG1GdW5jdGlvbi5OYW1lIz4iKV0KICAgIDwjPWNvZGVTdHJpbmdHZW5l
cmF0b3IuQ29tcG9zYWJsZUZ1bmN0aW9uTWV0aG9kKGVkbUZ1bmN0aW9uLCBt
b2RlbE5hbWVzcGFjZSkjPgogICAgewo8IysKICAgICAgICBjb2RlU3RyaW5n
R2VuZXJhdG9yLldyaXRlRnVuY3Rpb25QYXJhbWV0ZXJzKGVkbUZ1bmN0aW9u
LCBXcml0ZUZ1bmN0aW9uUGFyYW1ldGVyKTsKIz4KICAgICAgICA8Iz1jb2Rl
U3RyaW5nR2VuZXJhdG9yLkNvbXBvc2FibGVDcmVhdGVRdWVyeShlZG1GdW5j
dGlvbiwgbW9kZWxOYW1lc3BhY2UpIz4KICAgIH0KPCMrCiAgICB9CiAgICBl
bHNlCiAgICB7CiM+CgogICAgPCM9Y29kZVN0cmluZ0dlbmVyYXRvci5GdW5j
dGlvbk1ldGhvZChlZG1GdW5jdGlvbiwgbW9kZWxOYW1lc3BhY2UsIGluY2x1
ZGVNZXJnZU9wdGlvbikjPgogICAgewo8IysKICAgICAgICBjb2RlU3RyaW5n
R2VuZXJhdG9yLldyaXRlRnVuY3Rpb25QYXJhbWV0ZXJzKGVkbUZ1bmN0aW9u
LCBXcml0ZUZ1bmN0aW9uUGFyYW1ldGVyKTsKIz4KICAgICAgICA8Iz1jb2Rl
U3RyaW5nR2VuZXJhdG9yLkV4ZWN1dGVGdW5jdGlvbihlZG1GdW5jdGlvbiwg
bW9kZWxOYW1lc3BhY2UsIGluY2x1ZGVNZXJnZU9wdGlvbikjPgogICAgfQo8
IysKICAgICAgICBpZiAodHlwZU1hcHBlci5HZW5lcmF0ZU1lcmdlT3B0aW9u
RnVuY3Rpb24oZWRtRnVuY3Rpb24sIGluY2x1ZGVNZXJnZU9wdGlvbikpCiAg
ICAgICAgewogICAgICAgICAgICBXcml0ZUZ1bmN0aW9uSW1wb3J0KHR5cGVN
YXBwZXIsIGNvZGVTdHJpbmdHZW5lcmF0b3IsIGVkbUZ1bmN0aW9uLCBtb2Rl
bE5hbWVzcGFjZSwgaW5jbHVkZU1lcmdlT3B0aW9uOiB0cnVlKTsKICAgICAg
ICB9CiAgICB9Cn0KCnB1YmxpYyB2b2lkIFdyaXRlRnVuY3Rpb25QYXJhbWV0
ZXIoc3RyaW5nIG5hbWUsIHN0cmluZyBpc05vdE51bGwsIHN0cmluZyBub3RO
dWxsSW5pdCwgc3RyaW5nIG51bGxJbml0KQp7CiM+CiAgICAgICAgdmFyIDwj
PW5hbWUjPiA9IDwjPWlzTm90TnVsbCM+ID8KICAgICAgICAgICAgPCM9bm90
TnVsbEluaXQjPiA6CiAgICAgICAgICAgIDwjPW51bGxJbml0Iz47Cgo8IysK
fQoKcHVibGljIGNvbnN0IHN0cmluZyBUZW1wbGF0ZUlkID0gIkNTaGFycF9E
YkNvbnRleHRfQ29udGV4dF9FRjYiOwoKcHVibGljIGNsYXNzIENvZGVTdHJp
bmdHZW5lcmF0b3IKewogICAgcHJpdmF0ZSByZWFkb25seSBDb2RlR2VuZXJh
dGlvblRvb2xzIF9jb2RlOwogICAgcHJpdmF0ZSByZWFkb25seSBUeXBlTWFw
cGVyIF90eXBlTWFwcGVyOwogICAgcHJpdmF0ZSByZWFkb25seSBNZXRhZGF0
YVRvb2xzIF9lZjsKCiAgICBwdWJsaWMgQ29kZVN0cmluZ0dlbmVyYXRvcihD
b2RlR2VuZXJhdGlvblRvb2xzIGNvZGUsIFR5cGVNYXBwZXIgdHlwZU1hcHBl
ciwgTWV0YWRhdGFUb29scyBlZikKICAgIHsKICAgICAgICBBcmd1bWVudE5v
dE51bGwoY29kZSwgImNvZGUiKTsKICAgICAgICBBcmd1bWVudE5vdE51bGwo
dHlwZU1hcHBlciwgInR5cGVNYXBwZXIiKTsKICAgICAgICBBcmd1bWVudE5v
dE51bGwoZWYsICJlZiIpOwoKICAgICAgICBfY29kZSA9IGNvZGU7CiAgICAg
ICAgX3R5cGVNYXBwZXIgPSB0eXBlTWFwcGVyOwogICAgICAgIF9lZiA9IGVm
OwogICAgfQoKICAgIHB1YmxpYyBzdHJpbmcgUHJvcGVydHkoRWRtUHJvcGVy
dHkgZWRtUHJvcGVydHkpCiAgICB7CiAgICAgICAgcmV0dXJuIHN0cmluZy5G
b3JtYXQoCiAgICAgICAgICAgIEN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1
cmUsCiAgICAgICAgICAgICJ7MH0gezF9IHsyfSB7eyB7M31nZXQ7IHs0fXNl
dDsgfX0iLAogICAgICAgICAgICBBY2Nlc3NpYmlsaXR5LkZvclByb3BlcnR5
KGVkbVByb3BlcnR5KSwKICAgICAgICAgICAgX3R5cGVNYXBwZXIuR2V0VHlw
ZU5hbWUoZWRtUHJvcGVydHkuVHlwZVVzYWdlKSwKICAgICAgICAgICAgX2Nv
ZGUuRXNjYXBlKGVkbVByb3BlcnR5KSwKICAgICAgICAgICAgX2NvZGUuU3Bh
Y2VBZnRlcihBY2Nlc3NpYmlsaXR5LkZvckdldHRlcihlZG1Qcm9wZXJ0eSkp
LAogICAgICAgICAgICBfY29kZS5TcGFjZUFmdGVyKEFjY2Vzc2liaWxpdHku
Rm9yU2V0dGVyKGVkbVByb3BlcnR5KSkpOwogICAgfQoKICAgIHB1YmxpYyBz
dHJpbmcgTmF2aWdhdGlvblByb3BlcnR5KE5hdmlnYXRpb25Qcm9wZXJ0eSBu
YXZQcm9wKQogICAgewogICAgICAgIHZhciBlbmRUeXBlID0gX3R5cGVNYXBw
ZXIuR2V0VHlwZU5hbWUobmF2UHJvcC5Ub0VuZE1lbWJlci5HZXRFbnRpdHlU
eXBlKCkpOwogICAgICAgIHJldHVybiBzdHJpbmcuRm9ybWF0KAogICAgICAg
ICAgICBDdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLAogICAgICAgICAg
ICAiezB9IHsxfSB7Mn0ge3sgezN9Z2V0OyB7NH1zZXQ7IH19IiwKICAgICAg
ICAgICAgQWNjZXNzaWJpbGl0eUFuZFZpcnR1YWwoQWNjZXNzaWJpbGl0eS5G
b3JOYXZpZ2F0aW9uUHJvcGVydHkobmF2UHJvcCkpLAogICAgICAgICAgICBu
YXZQcm9wLlRvRW5kTWVtYmVyLlJlbGF0aW9uc2hpcE11bHRpcGxpY2l0eSA9
PSBSZWxhdGlvbnNoaXBNdWx0aXBsaWNpdHkuTWFueSA/ICgiSUNvbGxlY3Rp
b248IiArIGVuZFR5cGUgKyAiPiIpIDogZW5kVHlwZSwKICAgICAgICAgICAg
X2NvZGUuRXNjYXBlKG5hdlByb3ApLAogICAgICAgICAgICBfY29kZS5TcGFj
ZUFmdGVyKEFjY2Vzc2liaWxpdHkuRm9yR2V0dGVyKG5hdlByb3ApKSwKICAg
ICAgICAgICAgX2NvZGUuU3BhY2VBZnRlcihBY2Nlc3NpYmlsaXR5LkZvclNl
dHRlcihuYXZQcm9wKSkpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RyaW5n
IEFjY2Vzc2liaWxpdHlBbmRWaXJ0dWFsKHN0cmluZyBhY2Nlc3NpYmlsaXR5
KQogICAgewogICAgICAgIHJldHVybiBhY2Nlc3NpYmlsaXR5ICsgKGFjY2Vz
c2liaWxpdHkgIT0gInByaXZhdGUiID8gIiB2aXJ0dWFsIiA6ICIiKTsKICAg
IH0KICAgIAogICAgcHVibGljIHN0cmluZyBFbnRpdHlDbGFzc09wZW5pbmco
RW50aXR5VHlwZSBlbnRpdHkpCiAgICB7CiAgICAgICAgcmV0dXJuIHN0cmlu
Zy5Gb3JtYXQoCiAgICAgICAgICAgIEN1bHR1cmVJbmZvLkludmFyaWFudEN1
bHR1cmUsCiAgICAgICAgICAgICJ7MH0gezF9cGFydGlhbCBjbGFzcyB7Mn17
M30iLAogICAgICAgICAgICBBY2Nlc3NpYmlsaXR5LkZvclR5cGUoZW50aXR5
KSwKICAgICAgICAgICAgX2NvZGUuU3BhY2VBZnRlcihfY29kZS5BYnN0cmFj
dE9wdGlvbihlbnRpdHkpKSwKICAgICAgICAgICAgX2NvZGUuRXNjYXBlKGVu
dGl0eSksCiAgICAgICAgICAgIF9jb2RlLlN0cmluZ0JlZm9yZSgiIDogIiwg
X3R5cGVNYXBwZXIuR2V0VHlwZU5hbWUoZW50aXR5LkJhc2VUeXBlKSkpOwog
ICAgfQogICAgCiAgICBwdWJsaWMgc3RyaW5nIEVudW1PcGVuaW5nKFNpbXBs
ZVR5cGUgZW51bVR5cGUpCiAgICB7CiAgICAgICAgcmV0dXJuIHN0cmluZy5G
b3JtYXQoCiAgICAgICAgICAgIEN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1
cmUsCiAgICAgICAgICAgICJ7MH0gZW51bSB7MX0gOiB7Mn0iLAogICAgICAg
ICAgICBBY2Nlc3NpYmlsaXR5LkZvclR5cGUoZW51bVR5cGUpLAogICAgICAg
ICAgICBfY29kZS5Fc2NhcGUoZW51bVR5cGUpLAogICAgICAgICAgICBfY29k
ZS5Fc2NhcGUoX3R5cGVNYXBwZXIuVW5kZXJseWluZ0NsclR5cGUoZW51bVR5
cGUpKSk7CiAgICAgICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBXcml0ZUZ1
bmN0aW9uUGFyYW1ldGVycyhFZG1GdW5jdGlvbiBlZG1GdW5jdGlvbiwgQWN0
aW9uPHN0cmluZywgc3RyaW5nLCBzdHJpbmcsIHN0cmluZz4gd3JpdGVQYXJh
bWV0ZXIpCiAgICB7CiAgICAgICAgdmFyIHBhcmFtZXRlcnMgPSBGdW5jdGlv
bkltcG9ydFBhcmFtZXRlci5DcmVhdGUoZWRtRnVuY3Rpb24uUGFyYW1ldGVy
cywgX2NvZGUsIF9lZik7CiAgICAgICAgZm9yZWFjaCAodmFyIHBhcmFtZXRl
ciBpbiBwYXJhbWV0ZXJzLldoZXJlKHAgPT4gcC5OZWVkc0xvY2FsVmFyaWFi
bGUpKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGlzTm90TnVsbCA9IHBh
cmFtZXRlci5Jc051bGxhYmxlT2ZUID8gcGFyYW1ldGVyLkZ1bmN0aW9uUGFy
YW1ldGVyTmFtZSArICIuSGFzVmFsdWUiIDogcGFyYW1ldGVyLkZ1bmN0aW9u
UGFyYW1ldGVyTmFtZSArICIgIT0gbnVsbCI7CiAgICAgICAgICAgIHZhciBu
b3ROdWxsSW5pdCA9ICJuZXcgT2JqZWN0UGFyYW1ldGVyKFwiIiArIHBhcmFt
ZXRlci5Fc3FsUGFyYW1ldGVyTmFtZSArICJcIiwgIiArIHBhcmFtZXRlci5G
dW5jdGlvblBhcmFtZXRlck5hbWUgKyAiKSI7CiAgICAgICAgICAgIHZhciBu
dWxsSW5pdCA9ICJuZXcgT2JqZWN0UGFyYW1ldGVyKFwiIiArIHBhcmFtZXRl
ci5Fc3FsUGFyYW1ldGVyTmFtZSArICJcIiwgdHlwZW9mKCIgKyBUeXBlTWFw
cGVyLkZpeE5hbWVzcGFjZXMocGFyYW1ldGVyLlJhd0NsclR5cGVOYW1lKSAr
ICIpKSI7CiAgICAgICAgICAgIHdyaXRlUGFyYW1ldGVyKHBhcmFtZXRlci5M
b2NhbFZhcmlhYmxlTmFtZSwgaXNOb3ROdWxsLCBub3ROdWxsSW5pdCwgbnVs
bEluaXQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHN0cmlu
ZyBDb21wb3NhYmxlRnVuY3Rpb25NZXRob2QoRWRtRnVuY3Rpb24gZWRtRnVu
Y3Rpb24sIHN0cmluZyBtb2RlbE5hbWVzcGFjZSkKICAgIHsKICAgICAgICB2
YXIgcGFyYW1ldGVycyA9IF90eXBlTWFwcGVyLkdldFBhcmFtZXRlcnMoZWRt
RnVuY3Rpb24pOwogICAgICAgIAogICAgICAgIHJldHVybiBzdHJpbmcuRm9y
bWF0KAogICAgICAgICAgICBDdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJl
LAogICAgICAgICAgICAiezB9IElRdWVyeWFibGU8ezF9PiB7Mn0oezN9KSIs
CiAgICAgICAgICAgIEFjY2Vzc2liaWxpdHlBbmRWaXJ0dWFsKEFjY2Vzc2li
aWxpdHkuRm9yTWV0aG9kKGVkbUZ1bmN0aW9uKSksCiAgICAgICAgICAgIF90
eXBlTWFwcGVyLkdldFR5cGVOYW1lKF90eXBlTWFwcGVyLkdldFJldHVyblR5
cGUoZWRtRnVuY3Rpb24pLCBtb2RlbE5hbWVzcGFjZSksCiAgICAgICAgICAg
IF9jb2RlLkVzY2FwZShlZG1GdW5jdGlvbiksCiAgICAgICAgICAgIHN0cmlu
Zy5Kb2luKCIsICIsIHBhcmFtZXRlcnMuU2VsZWN0KHAgPT4gVHlwZU1hcHBl
ci5GaXhOYW1lc3BhY2VzKHAuRnVuY3Rpb25QYXJhbWV0ZXJUeXBlKSArICIg
IiArIHAuRnVuY3Rpb25QYXJhbWV0ZXJOYW1lKS5Ub0FycmF5KCkpKTsKICAg
IH0KICAgIAogICAgcHVibGljIHN0cmluZyBDb21wb3NhYmxlQ3JlYXRlUXVl
cnkoRWRtRnVuY3Rpb24gZWRtRnVuY3Rpb24sIHN0cmluZyBtb2RlbE5hbWVz
cGFjZSkKICAgIHsKICAgICAgICB2YXIgcGFyYW1ldGVycyA9IF90eXBlTWFw
cGVyLkdldFBhcmFtZXRlcnMoZWRtRnVuY3Rpb24pOwogICAgICAgIAogICAg
ICAgIHJldHVybiBzdHJpbmcuRm9ybWF0KAogICAgICAgICAgICBDdWx0dXJl
SW5mby5JbnZhcmlhbnRDdWx0dXJlLAogICAgICAgICAgICAicmV0dXJuICgo
SU9iamVjdENvbnRleHRBZGFwdGVyKXRoaXMpLk9iamVjdENvbnRleHQuQ3Jl
YXRlUXVlcnk8ezB9PihcIlt7MX1dLlt7Mn1dKHszfSlcIns0fSk7IiwKICAg
ICAgICAgICAgX3R5cGVNYXBwZXIuR2V0VHlwZU5hbWUoX3R5cGVNYXBwZXIu
R2V0UmV0dXJuVHlwZShlZG1GdW5jdGlvbiksIG1vZGVsTmFtZXNwYWNlKSwK
ICAgICAgICAgICAgZWRtRnVuY3Rpb24uTmFtZXNwYWNlTmFtZSwKICAgICAg
ICAgICAgZWRtRnVuY3Rpb24uTmFtZSwKICAgICAgICAgICAgc3RyaW5nLkpv
aW4oIiwgIiwgcGFyYW1ldGVycy5TZWxlY3QocCA9PiAiQCIgKyBwLkVzcWxQ
YXJhbWV0ZXJOYW1lKS5Ub0FycmF5KCkpLAogICAgICAgICAgICBfY29kZS5T
dHJpbmdCZWZvcmUoIiwgIiwgc3RyaW5nLkpvaW4oIiwgIiwgcGFyYW1ldGVy
cy5TZWxlY3QocCA9PiBwLkV4ZWN1dGVQYXJhbWV0ZXJOYW1lKS5Ub0FycmF5
KCkpKSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdHJpbmcgRnVuY3Rpb25N
ZXRob2QoRWRtRnVuY3Rpb24gZWRtRnVuY3Rpb24sIHN0cmluZyBtb2RlbE5h
bWVzcGFjZSwgYm9vbCBpbmNsdWRlTWVyZ2VPcHRpb24pCiAgICB7CiAgICAg
ICAgdmFyIHBhcmFtZXRlcnMgPSBfdHlwZU1hcHBlci5HZXRQYXJhbWV0ZXJz
KGVkbUZ1bmN0aW9uKTsKICAgICAgICB2YXIgcmV0dXJuVHlwZSA9IF90eXBl
TWFwcGVyLkdldFJldHVyblR5cGUoZWRtRnVuY3Rpb24pOwoKICAgICAgICB2
YXIgcGFyYW1MaXN0ID0gU3RyaW5nLkpvaW4oIiwgIiwgcGFyYW1ldGVycy5T
ZWxlY3QocCA9PiBUeXBlTWFwcGVyLkZpeE5hbWVzcGFjZXMocC5GdW5jdGlv
blBhcmFtZXRlclR5cGUpICsgIiAiICsgcC5GdW5jdGlvblBhcmFtZXRlck5h
bWUpLlRvQXJyYXkoKSk7CiAgICAgICAgaWYgKGluY2x1ZGVNZXJnZU9wdGlv
bikKICAgICAgICB7CiAgICAgICAgICAgIHBhcmFtTGlzdCA9IF9jb2RlLlN0
cmluZ0FmdGVyKHBhcmFtTGlzdCwgIiwgIikgKyAiTWVyZ2VPcHRpb24gbWVy
Z2VPcHRpb24iOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN0cmluZy5G
b3JtYXQoCiAgICAgICAgICAgIEN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1
cmUsCiAgICAgICAgICAgICJ7MH0gezF9IHsyfSh7M30pIiwKICAgICAgICAg
ICAgQWNjZXNzaWJpbGl0eUFuZFZpcnR1YWwoQWNjZXNzaWJpbGl0eS5Gb3JN
ZXRob2QoZWRtRnVuY3Rpb24pKSwKICAgICAgICAgICAgcmV0dXJuVHlwZSA9
PSBudWxsID8gImludCIgOiAiT2JqZWN0UmVzdWx0PCIgKyBfdHlwZU1hcHBl
ci5HZXRUeXBlTmFtZShyZXR1cm5UeXBlLCBtb2RlbE5hbWVzcGFjZSkgKyAi
PiIsCiAgICAgICAgICAgIF9jb2RlLkVzY2FwZShlZG1GdW5jdGlvbiksCiAg
ICAgICAgICAgIHBhcmFtTGlzdCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBz
dHJpbmcgRXhlY3V0ZUZ1bmN0aW9uKEVkbUZ1bmN0aW9uIGVkbUZ1bmN0aW9u
LCBzdHJpbmcgbW9kZWxOYW1lc3BhY2UsIGJvb2wgaW5jbHVkZU1lcmdlT3B0
aW9uKQogICAgewogICAgICAgIHZhciBwYXJhbWV0ZXJzID0gX3R5cGVNYXBw
ZXIuR2V0UGFyYW1ldGVycyhlZG1GdW5jdGlvbik7CiAgICAgICAgdmFyIHJl
dHVyblR5cGUgPSBfdHlwZU1hcHBlci5HZXRSZXR1cm5UeXBlKGVkbUZ1bmN0
aW9uKTsKCiAgICAgICAgdmFyIGNhbGxQYXJhbXMgPSBfY29kZS5TdHJpbmdC
ZWZvcmUoIiwgIiwgU3RyaW5nLkpvaW4oIiwgIiwgcGFyYW1ldGVycy5TZWxl
Y3QocCA9PiBwLkV4ZWN1dGVQYXJhbWV0ZXJOYW1lKS5Ub0FycmF5KCkpKTsK
ICAgICAgICBpZiAoaW5jbHVkZU1lcmdlT3B0aW9uKQogICAgICAgIHsKICAg
ICAgICAgICAgY2FsbFBhcmFtcyA9ICIsIG1lcmdlT3B0aW9uIiArIGNhbGxQ
YXJhbXM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBzdHJp
bmcuRm9ybWF0KAogICAgICAgICAgICBDdWx0dXJlSW5mby5JbnZhcmlhbnRD
dWx0dXJlLAogICAgICAgICAgICAicmV0dXJuICgoSU9iamVjdENvbnRleHRB
ZGFwdGVyKXRoaXMpLk9iamVjdENvbnRleHQuRXhlY3V0ZUZ1bmN0aW9uezB9
KFwiezF9XCJ7Mn0pOyIsCiAgICAgICAgICAgIHJldHVyblR5cGUgPT0gbnVs
bCA/ICIiIDogIjwiICsgX3R5cGVNYXBwZXIuR2V0VHlwZU5hbWUocmV0dXJu
VHlwZSwgbW9kZWxOYW1lc3BhY2UpICsgIj4iLAogICAgICAgICAgICBlZG1G
dW5jdGlvbi5OYW1lLAogICAgICAgICAgICBjYWxsUGFyYW1zKTsKICAgIH0K
ICAgIAogICAgcHVibGljIHN0cmluZyBEYlNldChFbnRpdHlTZXQgZW50aXR5
U2V0KQogICAgewogICAgICAgIHJldHVybiBzdHJpbmcuRm9ybWF0KAogICAg
ICAgICAgICBDdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLAogICAgICAg
ICAgICAiezB9IHZpcnR1YWwgRGJTZXQ8ezF9PiB7Mn0ge3sgZ2V0OyBzZXQ7
IH19IiwKICAgICAgICAgICAgQWNjZXNzaWJpbGl0eS5Gb3JSZWFkT25seVBy
b3BlcnR5KGVudGl0eVNldCksCiAgICAgICAgICAgIF90eXBlTWFwcGVyLkdl
dFR5cGVOYW1lKGVudGl0eVNldC5FbGVtZW50VHlwZSksCiAgICAgICAgICAg
IF9jb2RlLkVzY2FwZShlbnRpdHlTZXQpKTsKICAgIH0KCiAgICBwdWJsaWMg
c3RyaW5nIERiU2V0SW5pdGlhbGl6ZXIoRW50aXR5U2V0IGVudGl0eVNldCkK
ICAgIHsKICAgICAgICByZXR1cm4gc3RyaW5nLkZvcm1hdCgKICAgICAgICAg
ICAgQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwKICAgICAgICAgICAg
InswfSA9IFNldDx7MX0+KCk7IiwKICAgICAgICAgICAgX2NvZGUuRXNjYXBl
KGVudGl0eVNldCksCiAgICAgICAgICAgIF90eXBlTWFwcGVyLkdldFR5cGVO
YW1lKGVudGl0eVNldC5FbGVtZW50VHlwZSkpOwogICAgfQoKICAgIHB1Ymxp
YyBzdHJpbmcgVXNpbmdEaXJlY3RpdmVzKGJvb2wgaW5IZWFkZXIsIGJvb2wg
aW5jbHVkZUNvbGxlY3Rpb25zID0gdHJ1ZSkKICAgIHsKICAgICAgICByZXR1
cm4gaW5IZWFkZXIgPT0gc3RyaW5nLklzTnVsbE9yRW1wdHkoX2NvZGUuVnNO
YW1lc3BhY2VTdWdnZXN0aW9uKCkpCiAgICAgICAgICAgID8gc3RyaW5nLkZv
cm1hdCgKICAgICAgICAgICAgICAgIEN1bHR1cmVJbmZvLkludmFyaWFudEN1
bHR1cmUsCiAgICAgICAgICAgICAgICAiezB9dXNpbmcgU3lzdGVtO3sxfSIg
KwogICAgICAgICAgICAgICAgInsyfSIsCiAgICAgICAgICAgICAgICBpbkhl
YWRlciA/IEVudmlyb25tZW50Lk5ld0xpbmUgOiAiIiwKICAgICAgICAgICAg
ICAgIGluY2x1ZGVDb2xsZWN0aW9ucyA/IChFbnZpcm9ubWVudC5OZXdMaW5l
ICsgInVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOyIpIDogIiIs
CiAgICAgICAgICAgICAgICBpbkhlYWRlciA/ICIiIDogRW52aXJvbm1lbnQu
TmV3TGluZSkKICAgICAgICAgICAgOiAiIjsKICAgIH0KfQoKcHVibGljIGNs
YXNzIFR5cGVNYXBwZXIKewogICAgcHJpdmF0ZSBjb25zdCBzdHJpbmcgRXh0
ZXJuYWxUeXBlTmFtZUF0dHJpYnV0ZU5hbWUgPSBAImh0dHA6Ly9zY2hlbWFz
Lm1pY3Jvc29mdC5jb20vYWRvLzIwMDYvMDQvY29kZWdlbmVyYXRpb246RXh0
ZXJuYWxUeXBlTmFtZSI7CgogICAgcHJpdmF0ZSByZWFkb25seSBTeXN0ZW0u
Q29sbGVjdGlvbnMuSUxpc3QgX2Vycm9yczsKICAgIHByaXZhdGUgcmVhZG9u
bHkgQ29kZUdlbmVyYXRpb25Ub29scyBfY29kZTsKICAgIHByaXZhdGUgcmVh
ZG9ubHkgTWV0YWRhdGFUb29scyBfZWY7CgogICAgcHVibGljIHN0YXRpYyBz
dHJpbmcgRml4TmFtZXNwYWNlcyhzdHJpbmcgdHlwZU5hbWUpCiAgICB7CiAg
ICAgICAgcmV0dXJuIHR5cGVOYW1lLlJlcGxhY2UoIlN5c3RlbS5EYXRhLlNw
YXRpYWwuIiwgIlN5c3RlbS5EYXRhLkVudGl0eS5TcGF0aWFsLiIpOwogICAg
fQoKICAgIHB1YmxpYyBUeXBlTWFwcGVyKENvZGVHZW5lcmF0aW9uVG9vbHMg
Y29kZSwgTWV0YWRhdGFUb29scyBlZiwgU3lzdGVtLkNvbGxlY3Rpb25zLklM
aXN0IGVycm9ycykKICAgIHsKICAgICAgICBBcmd1bWVudE5vdE51bGwoY29k
ZSwgImNvZGUiKTsKICAgICAgICBBcmd1bWVudE5vdE51bGwoZWYsICJlZiIp
OwogICAgICAgIEFyZ3VtZW50Tm90TnVsbChlcnJvcnMsICJlcnJvcnMiKTsK
CiAgICAgICAgX2NvZGUgPSBjb2RlOwogICAgICAgIF9lZiA9IGVmOwogICAg
ICAgIF9lcnJvcnMgPSBlcnJvcnM7CiAgICB9CgogICAgcHVibGljIHN0cmlu
ZyBHZXRUeXBlTmFtZShUeXBlVXNhZ2UgdHlwZVVzYWdlKQogICAgewogICAg
ICAgIHJldHVybiB0eXBlVXNhZ2UgPT0gbnVsbCA/IG51bGwgOiBHZXRUeXBl
TmFtZSh0eXBlVXNhZ2UuRWRtVHlwZSwgX2VmLklzTnVsbGFibGUodHlwZVVz
YWdlKSwgbW9kZWxOYW1lc3BhY2U6IG51bGwpOwogICAgfQoKICAgIHB1Ymxp
YyBzdHJpbmcgR2V0VHlwZU5hbWUoRWRtVHlwZSBlZG1UeXBlKQogICAgewog
ICAgICAgIHJldHVybiBHZXRUeXBlTmFtZShlZG1UeXBlLCBpc051bGxhYmxl
OiBudWxsLCBtb2RlbE5hbWVzcGFjZTogbnVsbCk7CiAgICB9CgogICAgcHVi
bGljIHN0cmluZyBHZXRUeXBlTmFtZShUeXBlVXNhZ2UgdHlwZVVzYWdlLCBz
dHJpbmcgbW9kZWxOYW1lc3BhY2UpCiAgICB7CiAgICAgICAgcmV0dXJuIHR5
cGVVc2FnZSA9PSBudWxsID8gbnVsbCA6IEdldFR5cGVOYW1lKHR5cGVVc2Fn
ZS5FZG1UeXBlLCBfZWYuSXNOdWxsYWJsZSh0eXBlVXNhZ2UpLCBtb2RlbE5h
bWVzcGFjZSk7CiAgICB9CgogICAgcHVibGljIHN0cmluZyBHZXRUeXBlTmFt
ZShFZG1UeXBlIGVkbVR5cGUsIHN0cmluZyBtb2RlbE5hbWVzcGFjZSkKICAg
IHsKICAgICAgICByZXR1cm4gR2V0VHlwZU5hbWUoZWRtVHlwZSwgaXNOdWxs
YWJsZTogbnVsbCwgbW9kZWxOYW1lc3BhY2U6IG1vZGVsTmFtZXNwYWNlKTsK
ICAgIH0KCiAgICBwdWJsaWMgc3RyaW5nIEdldFR5cGVOYW1lKEVkbVR5cGUg
ZWRtVHlwZSwgYm9vbD8gaXNOdWxsYWJsZSwgc3RyaW5nIG1vZGVsTmFtZXNw
YWNlKQogICAgewogICAgICAgIGlmIChlZG1UeXBlID09IG51bGwpCiAgICAg
ICAgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAg
ICAgIHZhciBjb2xsZWN0aW9uVHlwZSA9IGVkbVR5cGUgYXMgQ29sbGVjdGlv
blR5cGU7CiAgICAgICAgaWYgKGNvbGxlY3Rpb25UeXBlICE9IG51bGwpCiAg
ICAgICAgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nLkZvcm1hdChDdWx0
dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCAiSUNvbGxlY3Rpb248ezB9PiIs
IEdldFR5cGVOYW1lKGNvbGxlY3Rpb25UeXBlLlR5cGVVc2FnZSwgbW9kZWxO
YW1lc3BhY2UpKTsKICAgICAgICB9CgogICAgICAgIHZhciB0eXBlTmFtZSA9
IF9jb2RlLkVzY2FwZShlZG1UeXBlLk1ldGFkYXRhUHJvcGVydGllcwogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5XaGVyZShwID0+IHAuTmFt
ZSA9PSBFeHRlcm5hbFR5cGVOYW1lQXR0cmlidXRlTmFtZSkKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAuU2VsZWN0KHAgPT4gKHN0cmluZylw
LlZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5GaXJz
dE9yRGVmYXVsdCgpKQogICAgICAgICAgICA/PyAobW9kZWxOYW1lc3BhY2Ug
IT0gbnVsbCAmJiBlZG1UeXBlLk5hbWVzcGFjZU5hbWUgIT0gbW9kZWxOYW1l
c3BhY2UgPwogICAgICAgICAgICAgICAgX2NvZGUuQ3JlYXRlRnVsbE5hbWUo
X2NvZGUuRXNjYXBlTmFtZXNwYWNlKGVkbVR5cGUuTmFtZXNwYWNlTmFtZSks
IF9jb2RlLkVzY2FwZShlZG1UeXBlKSkgOgogICAgICAgICAgICAgICAgX2Nv
ZGUuRXNjYXBlKGVkbVR5cGUpKTsKCiAgICAgICAgaWYgKGVkbVR5cGUgaXMg
U3RydWN0dXJhbFR5cGUpCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4g
dHlwZU5hbWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoZWRtVHlwZSBpcyBT
aW1wbGVUeXBlKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGNsclR5cGUg
PSBVbmRlcmx5aW5nQ2xyVHlwZShlZG1UeXBlKTsKICAgICAgICAgICAgaWYg
KCFJc0VudW1UeXBlKGVkbVR5cGUpKQogICAgICAgICAgICB7CiAgICAgICAg
ICAgICAgICB0eXBlTmFtZSA9IF9jb2RlLkVzY2FwZShjbHJUeXBlKTsKICAg
ICAgICAgICAgfQoKICAgICAgICAgICAgdHlwZU5hbWUgPSBGaXhOYW1lc3Bh
Y2VzKHR5cGVOYW1lKTsKCiAgICAgICAgICAgIHJldHVybiBjbHJUeXBlLklz
VmFsdWVUeXBlICYmIGlzTnVsbGFibGUgPT0gdHJ1ZSA/CiAgICAgICAgICAg
ICAgICBTdHJpbmcuRm9ybWF0KEN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1
cmUsICJOdWxsYWJsZTx7MH0+IiwgdHlwZU5hbWUpIDoKICAgICAgICAgICAg
ICAgIHR5cGVOYW1lOwogICAgICAgIH0KCiAgICAgICAgdGhyb3cgbmV3IEFy
Z3VtZW50RXhjZXB0aW9uKCJlZG1UeXBlIik7CiAgICB9CiAgICAKICAgIHB1
YmxpYyBUeXBlIFVuZGVybHlpbmdDbHJUeXBlKEVkbVR5cGUgZWRtVHlwZSkK
ICAgIHsKICAgICAgICBBcmd1bWVudE5vdE51bGwoZWRtVHlwZSwgImVkbVR5
cGUiKTsKCiAgICAgICAgdmFyIHByaW1pdGl2ZVR5cGUgPSBlZG1UeXBlIGFz
IFByaW1pdGl2ZVR5cGU7CiAgICAgICAgaWYgKHByaW1pdGl2ZVR5cGUgIT0g
bnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiBwcmltaXRpdmVU
eXBlLkNsckVxdWl2YWxlbnRUeXBlOwogICAgICAgIH0KCiAgICAgICAgaWYg
KElzRW51bVR5cGUoZWRtVHlwZSkpCiAgICAgICAgewogICAgICAgICAgICBy
ZXR1cm4gR2V0RW51bVVuZGVybHlpbmdUeXBlKGVkbVR5cGUpLkNsckVxdWl2
YWxlbnRUeXBlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHR5cGVvZihv
YmplY3QpOwogICAgfQogICAgCiAgICBwdWJsaWMgb2JqZWN0IEdldEVudW1N
ZW1iZXJWYWx1ZShNZXRhZGF0YUl0ZW0gZW51bU1lbWJlcikKICAgIHsKICAg
ICAgICBBcmd1bWVudE5vdE51bGwoZW51bU1lbWJlciwgImVudW1NZW1iZXIi
KTsKICAgICAgICAKICAgICAgICB2YXIgdmFsdWVQcm9wZXJ0eSA9IGVudW1N
ZW1iZXIuR2V0VHlwZSgpLkdldFByb3BlcnR5KCJWYWx1ZSIpOwogICAgICAg
IHJldHVybiB2YWx1ZVByb3BlcnR5ID09IG51bGwgPyBudWxsIDogdmFsdWVQ
cm9wZXJ0eS5HZXRWYWx1ZShlbnVtTWVtYmVyLCBudWxsKTsKICAgIH0KICAg
IAogICAgcHVibGljIHN0cmluZyBHZXRFbnVtTWVtYmVyTmFtZShNZXRhZGF0
YUl0ZW0gZW51bU1lbWJlcikKICAgIHsKICAgICAgICBBcmd1bWVudE5vdE51
bGwoZW51bU1lbWJlciwgImVudW1NZW1iZXIiKTsKICAgICAgICAKICAgICAg
ICB2YXIgbmFtZVByb3BlcnR5ID0gZW51bU1lbWJlci5HZXRUeXBlKCkuR2V0
UHJvcGVydHkoIk5hbWUiKTsKICAgICAgICByZXR1cm4gbmFtZVByb3BlcnR5
ID09IG51bGwgPyBudWxsIDogKHN0cmluZyluYW1lUHJvcGVydHkuR2V0VmFs
dWUoZW51bU1lbWJlciwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIFN5c3Rl
bS5Db2xsZWN0aW9ucy5JRW51bWVyYWJsZSBHZXRFbnVtTWVtYmVycyhFZG1U
eXBlIGVudW1UeXBlKQogICAgewogICAgICAgIEFyZ3VtZW50Tm90TnVsbChl
bnVtVHlwZSwgImVudW1UeXBlIik7CgogICAgICAgIHZhciBtZW1iZXJzUHJv
cGVydHkgPSBlbnVtVHlwZS5HZXRUeXBlKCkuR2V0UHJvcGVydHkoIk1lbWJl
cnMiKTsKICAgICAgICByZXR1cm4gbWVtYmVyc1Byb3BlcnR5ICE9IG51bGwg
CiAgICAgICAgICAgID8gKFN5c3RlbS5Db2xsZWN0aW9ucy5JRW51bWVyYWJs
ZSltZW1iZXJzUHJvcGVydHkuR2V0VmFsdWUoZW51bVR5cGUsIG51bGwpCiAg
ICAgICAgICAgIDogRW51bWVyYWJsZS5FbXB0eTxNZXRhZGF0YUl0ZW0+KCk7
CiAgICB9CiAgICAKICAgIHB1YmxpYyBib29sIEVudW1Jc0ZsYWdzKEVkbVR5
cGUgZW51bVR5cGUpCiAgICB7CiAgICAgICAgQXJndW1lbnROb3ROdWxsKGVu
dW1UeXBlLCAiZW51bVR5cGUiKTsKICAgICAgICAKICAgICAgICB2YXIgaXNG
bGFnc1Byb3BlcnR5ID0gZW51bVR5cGUuR2V0VHlwZSgpLkdldFByb3BlcnR5
KCJJc0ZsYWdzIik7CiAgICAgICAgcmV0dXJuIGlzRmxhZ3NQcm9wZXJ0eSAh
PSBudWxsICYmIChib29sKWlzRmxhZ3NQcm9wZXJ0eS5HZXRWYWx1ZShlbnVt
VHlwZSwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJvb2wgSXNFbnVtVHlw
ZShHbG9iYWxJdGVtIGVkbVR5cGUpCiAgICB7CiAgICAgICAgQXJndW1lbnRO
b3ROdWxsKGVkbVR5cGUsICJlZG1UeXBlIik7CgogICAgICAgIHJldHVybiBl
ZG1UeXBlLkdldFR5cGUoKS5OYW1lID09ICJFbnVtVHlwZSI7CiAgICB9Cgog
ICAgcHVibGljIFByaW1pdGl2ZVR5cGUgR2V0RW51bVVuZGVybHlpbmdUeXBl
KEVkbVR5cGUgZW51bVR5cGUpCiAgICB7CiAgICAgICAgQXJndW1lbnROb3RO
dWxsKGVudW1UeXBlLCAiZW51bVR5cGUiKTsKCiAgICAgICAgcmV0dXJuIChQ
cmltaXRpdmVUeXBlKWVudW1UeXBlLkdldFR5cGUoKS5HZXRQcm9wZXJ0eSgi
VW5kZXJseWluZ1R5cGUiKS5HZXRWYWx1ZShlbnVtVHlwZSwgbnVsbCk7CiAg
ICB9CgogICAgcHVibGljIHN0cmluZyBDcmVhdGVMaXRlcmFsKG9iamVjdCB2
YWx1ZSkKICAgIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1
ZS5HZXRUeXBlKCkgIT0gdHlwZW9mKFRpbWVTcGFuKSkKICAgICAgICB7CiAg
ICAgICAgICAgIHJldHVybiBfY29kZS5DcmVhdGVMaXRlcmFsKHZhbHVlKTsK
ICAgICAgICB9CgogICAgICAgIHJldHVybiBzdHJpbmcuRm9ybWF0KEN1bHR1
cmVJbmZvLkludmFyaWFudEN1bHR1cmUsICJuZXcgVGltZVNwYW4oezB9KSIs
ICgoVGltZVNwYW4pdmFsdWUpLlRpY2tzKTsKICAgIH0KICAgIAogICAgcHVi
bGljIGJvb2wgVmVyaWZ5Q2FzZUluc2Vuc2l0aXZlVHlwZVVuaXF1ZW5lc3Mo
SUVudW1lcmFibGU8c3RyaW5nPiB0eXBlcywgc3RyaW5nIHNvdXJjZUZpbGUp
CiAgICB7CiAgICAgICAgQXJndW1lbnROb3ROdWxsKHR5cGVzLCAidHlwZXMi
KTsKICAgICAgICBBcmd1bWVudE5vdE51bGwoc291cmNlRmlsZSwgInNvdXJj
ZUZpbGUiKTsKICAgICAgICAKICAgICAgICB2YXIgaGFzaCA9IG5ldyBIYXNo
U2V0PHN0cmluZz4oU3RyaW5nQ29tcGFyZXIuSW52YXJpYW50Q3VsdHVyZUln
bm9yZUNhc2UpOwogICAgICAgIGlmICh0eXBlcy5BbnkoaXRlbSA9PiAhaGFz
aC5BZGQoaXRlbSkpKQogICAgICAgIHsKICAgICAgICAgICAgX2Vycm9ycy5B
ZGQoCiAgICAgICAgICAgICAgICBuZXcgQ29tcGlsZXJFcnJvcihzb3VyY2VG
aWxlLCAtMSwgLTEsICI2MDIzIiwKICAgICAgICAgICAgICAgICAgICBTdHJp
bmcuRm9ybWF0KEN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlLCBDb2RlR2Vu
ZXJhdGlvblRvb2xzLkdldFJlc291cmNlU3RyaW5nKCJUZW1wbGF0ZV9DYXNl
SW5zZW5zaXRpdmVUeXBlQ29uZmxpY3QiKSkpKTsKICAgICAgICAgICAgcmV0
dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAg
IH0KICAgIAogICAgcHVibGljIElFbnVtZXJhYmxlPFNpbXBsZVR5cGU+IEdl
dEVudW1JdGVtc1RvR2VuZXJhdGUoSUVudW1lcmFibGU8R2xvYmFsSXRlbT4g
aXRlbUNvbGxlY3Rpb24pCiAgICB7CiAgICAgICAgcmV0dXJuIEdldEl0ZW1z
VG9HZW5lcmF0ZTxTaW1wbGVUeXBlPihpdGVtQ29sbGVjdGlvbikKICAgICAg
ICAgICAgLldoZXJlKGUgPT4gSXNFbnVtVHlwZShlKSk7CiAgICB9CiAgICAK
ICAgIHB1YmxpYyBJRW51bWVyYWJsZTxUPiBHZXRJdGVtc1RvR2VuZXJhdGU8
VD4oSUVudW1lcmFibGU8R2xvYmFsSXRlbT4gaXRlbUNvbGxlY3Rpb24pIHdo
ZXJlIFQ6IEVkbVR5cGUKICAgIHsKICAgICAgICByZXR1cm4gaXRlbUNvbGxl
Y3Rpb24KICAgICAgICAgICAgLk9mVHlwZTxUPigpCiAgICAgICAgICAgIC5X
aGVyZShpID0+ICFpLk1ldGFkYXRhUHJvcGVydGllcy5BbnkocCA9PiBwLk5h
bWUgPT0gRXh0ZXJuYWxUeXBlTmFtZUF0dHJpYnV0ZU5hbWUpKQogICAgICAg
ICAgICAuT3JkZXJCeShpID0+IGkuTmFtZSk7CiAgICB9CgogICAgcHVibGlj
IElFbnVtZXJhYmxlPHN0cmluZz4gR2V0QWxsR2xvYmFsSXRlbXMoSUVudW1l
cmFibGU8R2xvYmFsSXRlbT4gaXRlbUNvbGxlY3Rpb24pCiAgICB7CiAgICAg
ICAgcmV0dXJuIGl0ZW1Db2xsZWN0aW9uCiAgICAgICAgICAgIC5XaGVyZShp
ID0+IGkgaXMgRW50aXR5VHlwZSB8fCBpIGlzIENvbXBsZXhUeXBlIHx8IGkg
aXMgRW50aXR5Q29udGFpbmVyIHx8IElzRW51bVR5cGUoaSkpCiAgICAgICAg
ICAgIC5TZWxlY3QoZyA9PiBHZXRHbG9iYWxJdGVtTmFtZShnKSk7CiAgICB9
CgogICAgcHVibGljIHN0cmluZyBHZXRHbG9iYWxJdGVtTmFtZShHbG9iYWxJ
dGVtIGl0ZW0pCiAgICB7CiAgICAgICAgaWYgKGl0ZW0gaXMgRWRtVHlwZSkK
ICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAoKEVkbVR5cGUpaXRlbSku
TmFtZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAg
ICAgICAgcmV0dXJuICgoRW50aXR5Q29udGFpbmVyKWl0ZW0pLk5hbWU7CiAg
ICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBJRW51bWVyYWJsZTxFZG1Qcm9w
ZXJ0eT4gR2V0U2ltcGxlUHJvcGVydGllcyhFbnRpdHlUeXBlIHR5cGUpCiAg
ICB7CiAgICAgICAgcmV0dXJuIHR5cGUuUHJvcGVydGllcy5XaGVyZShwID0+
IHAuVHlwZVVzYWdlLkVkbVR5cGUgaXMgU2ltcGxlVHlwZSAmJiBwLkRlY2xh
cmluZ1R5cGUgPT0gdHlwZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBJRW51
bWVyYWJsZTxFZG1Qcm9wZXJ0eT4gR2V0U2ltcGxlUHJvcGVydGllcyhDb21w
bGV4VHlwZSB0eXBlKQogICAgewogICAgICAgIHJldHVybiB0eXBlLlByb3Bl
cnRpZXMuV2hlcmUocCA9PiBwLlR5cGVVc2FnZS5FZG1UeXBlIGlzIFNpbXBs
ZVR5cGUgJiYgcC5EZWNsYXJpbmdUeXBlID09IHR5cGUpOwogICAgfQogICAg
CiAgICBwdWJsaWMgSUVudW1lcmFibGU8RWRtUHJvcGVydHk+IEdldENvbXBs
ZXhQcm9wZXJ0aWVzKEVudGl0eVR5cGUgdHlwZSkKICAgIHsKICAgICAgICBy
ZXR1cm4gdHlwZS5Qcm9wZXJ0aWVzLldoZXJlKHAgPT4gcC5UeXBlVXNhZ2Uu
RWRtVHlwZSBpcyBDb21wbGV4VHlwZSAmJiBwLkRlY2xhcmluZ1R5cGUgPT0g
dHlwZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBJRW51bWVyYWJsZTxFZG1Q
cm9wZXJ0eT4gR2V0Q29tcGxleFByb3BlcnRpZXMoQ29tcGxleFR5cGUgdHlw
ZSkKICAgIHsKICAgICAgICByZXR1cm4gdHlwZS5Qcm9wZXJ0aWVzLldoZXJl
KHAgPT4gcC5UeXBlVXNhZ2UuRWRtVHlwZSBpcyBDb21wbGV4VHlwZSAmJiBw
LkRlY2xhcmluZ1R5cGUgPT0gdHlwZSk7CiAgICB9CgogICAgcHVibGljIElF
bnVtZXJhYmxlPEVkbVByb3BlcnR5PiBHZXRQcm9wZXJ0aWVzV2l0aERlZmF1
bHRWYWx1ZXMoRW50aXR5VHlwZSB0eXBlKQogICAgewogICAgICAgIHJldHVy
biB0eXBlLlByb3BlcnRpZXMuV2hlcmUocCA9PiBwLlR5cGVVc2FnZS5FZG1U
eXBlIGlzIFNpbXBsZVR5cGUgJiYgcC5EZWNsYXJpbmdUeXBlID09IHR5cGUg
JiYgcC5EZWZhdWx0VmFsdWUgIT0gbnVsbCk7CiAgICB9CiAgICAKICAgIHB1
YmxpYyBJRW51bWVyYWJsZTxFZG1Qcm9wZXJ0eT4gR2V0UHJvcGVydGllc1dp
dGhEZWZhdWx0VmFsdWVzKENvbXBsZXhUeXBlIHR5cGUpCiAgICB7CiAgICAg
ICAgcmV0dXJuIHR5cGUuUHJvcGVydGllcy5XaGVyZShwID0+IHAuVHlwZVVz
YWdlLkVkbVR5cGUgaXMgU2ltcGxlVHlwZSAmJiBwLkRlY2xhcmluZ1R5cGUg
PT0gdHlwZSAmJiBwLkRlZmF1bHRWYWx1ZSAhPSBudWxsKTsKICAgIH0KCiAg
ICBwdWJsaWMgSUVudW1lcmFibGU8TmF2aWdhdGlvblByb3BlcnR5PiBHZXRO
YXZpZ2F0aW9uUHJvcGVydGllcyhFbnRpdHlUeXBlIHR5cGUpCiAgICB7CiAg
ICAgICAgcmV0dXJuIHR5cGUuTmF2aWdhdGlvblByb3BlcnRpZXMuV2hlcmUo
bnAgPT4gbnAuRGVjbGFyaW5nVHlwZSA9PSB0eXBlKTsKICAgIH0KICAgIAog
ICAgcHVibGljIElFbnVtZXJhYmxlPE5hdmlnYXRpb25Qcm9wZXJ0eT4gR2V0
Q29sbGVjdGlvbk5hdmlnYXRpb25Qcm9wZXJ0aWVzKEVudGl0eVR5cGUgdHlw
ZSkKICAgIHsKICAgICAgICByZXR1cm4gdHlwZS5OYXZpZ2F0aW9uUHJvcGVy
dGllcy5XaGVyZShucCA9PiBucC5EZWNsYXJpbmdUeXBlID09IHR5cGUgJiYg
bnAuVG9FbmRNZW1iZXIuUmVsYXRpb25zaGlwTXVsdGlwbGljaXR5ID09IFJl
bGF0aW9uc2hpcE11bHRpcGxpY2l0eS5NYW55KTsKICAgIH0KICAgIAogICAg
cHVibGljIEZ1bmN0aW9uUGFyYW1ldGVyIEdldFJldHVyblBhcmFtZXRlcihF
ZG1GdW5jdGlvbiBlZG1GdW5jdGlvbikKICAgIHsKICAgICAgICBBcmd1bWVu
dE5vdE51bGwoZWRtRnVuY3Rpb24sICJlZG1GdW5jdGlvbiIpOwoKICAgICAg
ICB2YXIgcmV0dXJuUGFyYW1zUHJvcGVydHkgPSBlZG1GdW5jdGlvbi5HZXRU
eXBlKCkuR2V0UHJvcGVydHkoIlJldHVyblBhcmFtZXRlcnMiKTsKICAgICAg
ICByZXR1cm4gcmV0dXJuUGFyYW1zUHJvcGVydHkgPT0gbnVsbAogICAgICAg
ICAgICA/IGVkbUZ1bmN0aW9uLlJldHVyblBhcmFtZXRlcgogICAgICAgICAg
ICA6ICgoSUVudW1lcmFibGU8RnVuY3Rpb25QYXJhbWV0ZXI+KXJldHVyblBh
cmFtc1Byb3BlcnR5LkdldFZhbHVlKGVkbUZ1bmN0aW9uLCBudWxsKSkuRmly
c3RPckRlZmF1bHQoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbCBJc0NvbXBv
c2FibGUoRWRtRnVuY3Rpb24gZWRtRnVuY3Rpb24pCiAgICB7CiAgICAgICAg
QXJndW1lbnROb3ROdWxsKGVkbUZ1bmN0aW9uLCAiZWRtRnVuY3Rpb24iKTsK
CiAgICAgICAgdmFyIGlzQ29tcG9zYWJsZVByb3BlcnR5ID0gZWRtRnVuY3Rp
b24uR2V0VHlwZSgpLkdldFByb3BlcnR5KCJJc0NvbXBvc2FibGVBdHRyaWJ1
dGUiKTsKICAgICAgICByZXR1cm4gaXNDb21wb3NhYmxlUHJvcGVydHkgIT0g
bnVsbCAmJiAoYm9vbClpc0NvbXBvc2FibGVQcm9wZXJ0eS5HZXRWYWx1ZShl
ZG1GdW5jdGlvbiwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIElFbnVtZXJh
YmxlPEZ1bmN0aW9uSW1wb3J0UGFyYW1ldGVyPiBHZXRQYXJhbWV0ZXJzKEVk
bUZ1bmN0aW9uIGVkbUZ1bmN0aW9uKQogICAgewogICAgICAgIHJldHVybiBG
dW5jdGlvbkltcG9ydFBhcmFtZXRlci5DcmVhdGUoZWRtRnVuY3Rpb24uUGFy
YW1ldGVycywgX2NvZGUsIF9lZik7CiAgICB9CgogICAgcHVibGljIFR5cGVV
c2FnZSBHZXRSZXR1cm5UeXBlKEVkbUZ1bmN0aW9uIGVkbUZ1bmN0aW9uKQog
ICAgewogICAgICAgIHZhciByZXR1cm5QYXJhbSA9IEdldFJldHVyblBhcmFt
ZXRlcihlZG1GdW5jdGlvbik7CiAgICAgICAgcmV0dXJuIHJldHVyblBhcmFt
ID09IG51bGwgPyBudWxsIDogX2VmLkdldEVsZW1lbnRUeXBlKHJldHVyblBh
cmFtLlR5cGVVc2FnZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBib29sIEdl
bmVyYXRlTWVyZ2VPcHRpb25GdW5jdGlvbihFZG1GdW5jdGlvbiBlZG1GdW5j
dGlvbiwgYm9vbCBpbmNsdWRlTWVyZ2VPcHRpb24pCiAgICB7CiAgICAgICAg
dmFyIHJldHVyblR5cGUgPSBHZXRSZXR1cm5UeXBlKGVkbUZ1bmN0aW9uKTsK
ICAgICAgICByZXR1cm4gIWluY2x1ZGVNZXJnZU9wdGlvbiAmJiByZXR1cm5U
eXBlICE9IG51bGwgJiYgcmV0dXJuVHlwZS5FZG1UeXBlLkJ1aWx0SW5UeXBl
S2luZCA9PSBCdWlsdEluVHlwZUtpbmQuRW50aXR5VHlwZTsKICAgIH0KfQoK
cHVibGljIHN0YXRpYyB2b2lkIEFyZ3VtZW50Tm90TnVsbDxUPihUIGFyZywg
c3RyaW5nIG5hbWUpIHdoZXJlIFQgOiBjbGFzcwp7CiAgICBpZiAoYXJnID09
IG51bGwpCiAgICB7CiAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4
Y2VwdGlvbihuYW1lKTsKICAgIH0KfQojPg==
